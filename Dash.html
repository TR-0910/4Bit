<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identity Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8e4d9 0%, #a4b5a0 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            background: #f8f6f0; /* Beige background */
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 80vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 300px;
            background: #6b8e6b; /* Sage green */
            color: white;
            padding: 0;
        }

        .sidebar-section {
            border-bottom: 1px solid #5a7a5a;
        }

        .section-header {
            padding: 20px;
            background: #5a7a5a; /* Darker sage green */
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header:hover {
            background: #4a6a4a;
        }

        .section-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: white; /* White text for section headers */
        }

        .arrow {
            transition: transform 0.3s ease;
            color: white; /* White arrows */
        }

        .arrow.expanded {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background: #6b8e6b;
        }

        .section-content.expanded {
            padding: 20px;
            max-height: 1000px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 40px;
            background: #f8f6f0; /* Beige */
        }

        .content-area {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-area.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #5a7a5a; /* Sage green text */
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1ccc0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: #fffdf6; /* Light beige */
        }

        .form-control:focus {
            outline: none;
            border-color: #6b8e6b; /* Sage green */
            background: white;
        }

        .form-control:invalid {
            border-color: #e74c3c;
        }

        .form-control:valid {
            border-color: #27ae60;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #6b8e6b; /* Sage green */
            color: white;
        }

        .btn-primary:hover {
            background: #5a7a5a;
        }

        .btn-success {
            background: #8a9b6b; /* Olive green */
            color: white;
        }

        .btn-success:hover {
            background: #7a8b5b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* Table Styles */
        .credentials-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .credentials-table th,
        .credentials-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .credentials-table th {
            background: #5a7a5a; /* Sage green */
            color: white;
            font-weight: 600;
        }

        .status-pending {
            color: #f39c12;
            font-weight: 600;
        }

        .status-verified {
            color: #27ae60;
            font-weight: 600;
        }

        .status-verifying {
            color: #3498db;
            font-weight: 600;
        }

        .file-upload {
            border: 2px dashed #b8c6b1;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: border-color 0.3s ease;
            background: #f8f6f0;
        }

        .file-upload:hover {
            border-color: #6b8e6b;
        }

        .file-upload input {
            margin: 15px 0;
        }

        /* Phone number validation styles */
        .phone-hint {
            font-size: 12px;
            color: #d1ccc0;
            margin-top: 5px;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        h2, h3, h4 {
            color: #5a7a5a; /* Sage green headings */
        }

        p {
            color: #666;
        }

        /* DID Display Styles */
        .did-display {
            background: #5a7a5a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .did-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #fff;
            font-size: 14px;
            word-break: break-all;
            margin: 10px 0;
        }

        .did-label {
            color: #b8c6b1;
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* DID Section Styles */
        .did-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .did-section p {
            color: white;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            margin: 10px 0;
            font-size: 13px;
        }

        .did-section button {
            width: 100%;
            margin-top: 10px;
        }

        /* Credential Fields Styles */
        .credential-fields {
            border-left: 3px solid #6b8e6b;
            padding-left: 15px;
            margin: 15px 0;
        }

        .action-wrapper {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.9em;
        }

        /* Session Timeout Styles */
        .session-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 10001;
            font-weight: bold;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- DID Display at the top -->
            <div class="did-display">
                <div class="did-label">YOUR DECENTRALIZED IDENTIFIER</div>
                <div class="did-value" id="sidebar-did">did:user:9f3b2c1dA4...</div>
            </div>

            <div class="sidebar-section">
                <div class="section-header" onclick="toggleSection('identity')">
                    <h3>üì± My Identity</h3>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="section-content expanded" id="identity-content">
                    <!-- DID Section -->
                    <div class="did-section">
                        <label style="color: white;"><strong>DID:</strong></label>
                        <p id="did-display">did:user:9f3b2c1dA4...</p>
                        <button class="btn btn-secondary" onclick="generateDID()">Generate New DID</button>
                    </div>

                    <form id="identity-form">
                        <div class="form-group">
                            <label style="color: white;" for="fullName">Full Name</label>
                            <input type="text" id="fullName" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label style="color: white;" for="contactNumber">Contact Number</label>
                            <input type="tel" id="contactNumber" class="form-control" 
                                   placeholder="Enter 10-digit number" 
                                   pattern="[0-9]{10}"
                                   maxlength="10"
                                   required>
                            <div class="phone-hint">Must be exactly 10 digits</div>
                            <div class="error-message" id="phone-error">Please enter a valid 10-digit phone number</div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="updateIdentity()" style="width: 100%;">
                            Update Identity
                        </button>
                    </form>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header" onclick="toggleSection('credentials')">
                    <h3>üìÑ My Credentials</h3>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="section-content" id="credentials-content">
                    <button type="button" class="btn btn-success" onclick="showContent('credentials-main')" style="width: 100%; margin-bottom: 15px;">
                        Manage Credentials
                    </button>
                    <div style="font-size: 12px; color: #d1ccc0;">
                        <p id="credentials-count">üìã 2 credentials pending</p>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header" onclick="toggleSection('upload')">
                    <h3>‚òÅÔ∏è Upload to IPFS</h3>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="section-content" id="upload-content">
                    <div class="file-upload">
                        <p>Upload documents to decentralized IPFS storage</p>
                        <input type="file" class="form-control">
                        <button type="button" class="btn btn-primary" onclick="showContent('upload-main')" style="width: 100%;">
                            Upload Document
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Identity Content -->
            <div id="identity-main" class="content-area active">
                <h2>üë§ My Identity</h2>
                <p>Manage your personal identity information</p>
                
                <div class="did-display" style="background: #6b8e6b; max-width: 500px;">
                    <div class="did-label">ACTIVE DECENTRALIZED IDENTIFIER</div>
                    <div class="did-value" id="main-did">did:user:9f3b2c1dA4...</div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 10px; margin-top: 20px; max-width: 500px;">
                    <div class="form-group">
                        <label for="displayFullName">Full Name</label>
                        <input type="text" id="displayFullName" class="form-control" value="Not set" readonly>
                    </div>
                    <div class="form-group">
                        <label for="displayContactNumber">Contact Number</label>
                        <input type="text" id="displayContactNumber" class="form-control" value="Not set" readonly>
                    </div>
                    <div class="form-group">
                        <label>Identity Status</label>
                        <div style="padding: 10px; background: #fff3cd; border-radius: 5px; color: #856404;">
                            ‚ö†Ô∏è Identity information pending
                        </div>
                    </div>
                </div>
            </div>

            <!-- Credentials Content -->
            <div id="credentials-main" class="content-area">
                <h2>üìÑ My Credentials</h2>
                <p>Manage your digital credentials and documents</p>
                
                <div class="did-display" style="background: #6b8e6b; margin-bottom: 20px;">
                    <div class="did-label">VERIFICATION IDENTIFIER</div>
                    <div class="did-value" id="credentials-did">did:user:9f3b2c1dA4...</div>
                </div>

                <table class="credentials-table">
                    <thead>
                        <tr>
                            <th>Credential</th>
                            <th>Issuer</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="credentials-table-body">
                        <!-- Credentials will be dynamically added here -->
                    </tbody>
                </table>
                
                <!-- Add New Credential Section -->
                <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 10px;">
                    <h3>‚ûï Add New Credential</h3>
                    <form id="add-credential-form">
                        <div class="form-group">
                            <label for="credentialType">Select Credential Type</label>
                            <select id="credentialType" class="form-control" onchange="showCustomFields()">
                                <option value="">-- Select Credential Type --</option>
                                <option value="aadhaar">üÜî Aadhaar Card</option>
                                <option value="pan">üí≥ PAN Card</option>
                                <option value="dl">üöó Driving License</option>
                                <option value="passport">üõÇ Passport</option>
                                <option value="education">üéì Education Certificate</option>
                                <option value="voter">üó≥Ô∏è Voter ID</option>
                            </select>
                        </div>

                        <!-- Aadhaar Specific Fields -->
                        <div id="aadhaar-fields" class="credential-fields" style="display: none;">
                            <div class="form-group">
                                <label for="aadhaarNumber">Aadhaar Number</label>
                                <input type="text" id="aadhaarNumber" class="form-control" placeholder="Enter 12-digit Aadhaar number" maxlength="12" pattern="[0-9]{12}">
                            </div>
                            
                            <!-- DEMO BUTTON ADDED HERE -->
                            <div class="form-group">
                                <button type="button" class="btn btn-secondary" onclick="demoValidation()" 
                                        style="width: 100%; margin-top: 10px; padding: 10px;">
                                    üß™ Load Test Aadhaar (For Demo)
                                </button>
                                <small style="color: #666; display: block; text-align: center; margin-top: 5px;">
                                    Click then press "Validate" to test verification
                                </small>
                            </div>
                            
                            <div id="ai-status" style="margin: 10px 0; padding: 10px; border-radius: 5px; display: none; font-size: 14px;"></div>
                            
                            <div class="form-group">
                                <label for="aadhaarFile">Upload Aadhaar Card</label>
                                <input type="file" id="aadhaarFile" class="form-control" accept=".jpg,.jpeg,.png" onchange="verifyAadhaarOnUpload(this)">
                            </div>
                        </div>

                        <!-- PAN Card Specific Fields -->
                        <div id="pan-fields" class="credential-fields" style="display: none;">
                            <div class="form-group">
                                <label for="panNumber">PAN Number</label>
                                <input type="text" id="panNumber" class="form-control" placeholder="Enter PAN number (e.g., ABCDE1234F)" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}">
                            </div>
                            <div class="form-group">
                                <label for="panFile">Upload PAN Card (PDF/Image)</label>
                                <input type="file" id="panFile" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>

                        <!-- Generic Fields for other credentials -->
                        <div id="generic-fields" class="credential-fields" style="display: none;">
                            <div class="form-group">
                                <label for="documentNumber">Document Number</label>
                                <input type="text" id="documentNumber" class="form-control" placeholder="Enter document number">
                            </div>
                            <div class="form-group">
                                <label for="issuingAuthority">Issuing Authority</label>
                                <input type="text" id="issuingAuthority" class="form-control" placeholder="Enter issuing authority">
                            </div>
                            <div class="form-group">
                                <label for="documentFile">Upload Document (PDF/Image)</label>
                                <input type="file" id="documentFile" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>

                        <!-- Common Fields -->
                        <div class="form-group">
                            <label for="issueDate">Issue Date</label>
                            <input type="date" id="issueDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date (if any)</label>
                            <input type="date" id="expiryDate" class="form-control">
                        </div>
                        
                        <button type="button" class="btn btn-success" onclick="addNewCredential()">Add Credential</button>
                    </form>
                </div>
            </div>

                        <!-- Upload Content -->
            <div id="upload-main" class="content-area">
                <h2>‚òÅÔ∏è Document Storage</h2>
                <p>Upload your documents to decentralized IPFS storage</p>

                <div class="did-display" style="background: #6b8e6b; margin-bottom: 20px;">
                    <div class="did-label">STORAGE IDENTIFIER</div>
                    <div class="did-value" id="upload-did">did:user:9f3b2c1dA4...</div>
                </div>
                
                <div class="file-upload" style="max-width: 500px; margin: 30px 0;">
                    <h4>üì§ Upload Document</h4>
                    <input type="file" id="ipfs-file-input" class="form-control" multiple>
                    <button type="button" class="btn btn-primary" onclick="uploadToIPFS()" style="width: 100%; margin-top: 15px;">
                        Upload to IPFS
                    </button>
                    <p style="margin-top: 15px; font-size: 12px; color: #7f8c8d;">
                        üîí Store documents securely on the blockchain
                    </p>
                </div>

                <div style="background: white; padding: 25px; border-radius: 10px;">
                    <h3>üìÇ Uploaded Documents</h3>
                    <div id="uploaded-documents-list">
                        <p style="color: #999; font-style: italic;">No documents uploaded yet</p>
                    </div>
                </div>
            </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>

    <script>
        // Essential credentials with predefined issuers
        const essentialCredentials = {
            'aadhaar': { name: 'üÜî Aadhaar Card', issuer: 'UIDAI, Government of India' },
            'pan': { name: 'üí≥ PAN Card', issuer: 'Income Tax Department, India' },
            'dl': { name: 'üöó Driving License', issuer: 'Regional Transport Office' },
            'passport': { name: 'üõÇ Passport', issuer: 'Ministry of External Affairs' },
            'education': { name: 'üéì Education Certificate', issuer: 'University/Board' },
            'voter': { name: 'üó≥Ô∏è Voter ID', issuer: 'Election Commission of India' }
        };

        // Generate random DID
        function generateDID() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let randomPart = '';
            for (let i = 0; i < 12; i++) {
                randomPart += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            const newDID = `did:user:${randomPart}...`;
            
            // Update all DID displays
            document.getElementById('did-display').textContent = newDID;
            document.getElementById('sidebar-did').textContent = newDID;
            document.getElementById('main-did').textContent = newDID;
            document.getElementById('credentials-did').textContent = newDID;
            document.getElementById('upload-did').textContent = newDID;
            
            alert('New DID generated successfully!');
        }

        // Toggle sidebar sections
        function toggleSection(section) {
            const content = document.getElementById(section + '-content');
            const arrow = content.previousElementSibling.querySelector('.arrow');
            
            // Toggle current section
            content.classList.toggle('expanded');
            arrow.classList.toggle('expanded');
        }

        // Show main content based on sidebar click
        function showContent(contentId) {
            // Hide all content areas
            const contentAreas = document.querySelectorAll('.content-area');
            contentAreas.forEach(area => area.classList.remove('active'));
            
            // Show selected content area
            document.getElementById(contentId).classList.add('active');
        }

        // Update identity information
        function updateIdentity() {
            const fullName = document.getElementById('fullName').value;
            const contactNumber = document.getElementById('contactNumber').value;
            
            if (fullName && contactNumber.length === 10) {
                document.getElementById('displayFullName').value = fullName;
                document.getElementById('displayContactNumber').value = contactNumber;
                
                // Save to localStorage for session recovery
                localStorage.setItem('userFullName', fullName);
                localStorage.setItem('userContact', contactNumber);
                
                showToast('Identity updated successfully!', 'success');
                showContent('identity-main');
            } else {
                showToast('Please fill all fields correctly. Phone must be 10 digits.', 'error');
            }
        }

        // Phone number validation
        document.getElementById('contactNumber').addEventListener('input', function(e) {
            const phoneInput = e.target;
            const errorElement = document.getElementById('phone-error');
            const value = phoneInput.value.replace(/\D/g, ''); // Remove non-digits
            
            // Update input value with only numbers
            phoneInput.value = value;
            
            // Validate length
            if (value.length === 10) {
                phoneInput.setCustomValidity('');
                errorElement.style.display = 'none';
            } else {
                phoneInput.setCustomValidity('Phone number must be 10 digits');
                errorElement.style.display = 'block';
            }
        });

        // Prevent non-numeric input
        document.getElementById('contactNumber').addEventListener('keypress', function(e) {
            const charCode = e.which ? e.which : e.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                e.preventDefault();
            }
        });

        // Show/hide specific fields based on credential type
        function showCustomFields() {
            // Hide all fields first
            document.querySelectorAll('.credential-fields').forEach(field => {
                field.style.display = 'none';
            });
            
            const selectedType = document.getElementById('credentialType').value;
            
            if (selectedType === 'aadhaar') {
                document.getElementById('aadhaar-fields').style.display = 'block';
            } else if (selectedType === 'pan') {
                document.getElementById('pan-fields').style.display = 'block';
            } else if (selectedType) {
                document.getElementById('generic-fields').style.display = 'block';
            }
        }

        // Add new credential to the table
        function addNewCredential() {
            const type = document.getElementById('credentialType').value;
            const typeDisplay = document.getElementById('credentialType').selectedOptions[0].text;
            
            if (!type) {
                alert('Please select a credential type');
                return;
            }

            let number, issuer;
            
            if (type === 'aadhaar') {
                number = document.getElementById('aadhaarNumber').value;
                issuer = 'UIDAI, Government of India';
                if (!number || number.length !== 12) {
                    alert('Please enter a valid 12-digit Aadhaar number');
                    return;
                }
            } else if (type === 'pan') {
                number = document.getElementById('panNumber').value;
                issuer = 'Income Tax Department, India';
                if (!number || !/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(number)) {
                    alert('Please enter a valid PAN number (Format: ABCDE1234F)');
                    return;
                }
            } else {
                number = document.getElementById('documentNumber').value;
                issuer = document.getElementById('issuingAuthority').value;
                if (!number || !issuer) {
                    alert('Please fill all required fields');
                    return;
                }
            }

            // Add to credentials table
            addCredentialToTable(typeDisplay, issuer, type.toUpperCase(), number);
            
            // Reset form
            document.getElementById('add-credential-form').reset();
            document.querySelectorAll('.credential-fields').forEach(field => {
                field.style.display = 'none';
            });
            
            alert('Credential added successfully! Status: Pending Verification');
        }

        // Add credential row to the table
        function addCredentialToTable(credential, issuer, type, number) {
            const tbody = document.getElementById('credentials-table-body');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td>${credential}</td>
                <td>${issuer}</td>
                <td>${type}</td>
                <td class="status-pending">‚è≥ Pending</td>
                <td class="action-wrapper">
                    <button class="btn btn-primary btn-small" onclick="viewCredential('${number}')">View</button>
                    <button class="btn btn-warning btn-small" onclick="verifyAadhaarWithValidation()">Validate</button>
                    <button class="btn btn-danger btn-small" onclick="deleteCredential(this)">Delete</button>
                </td>
            `;
            
            tbody.appendChild(newRow);
            updateCredentialsCount();
        }

        // Verify credential (simulate verification process)
        function verifyCredential(button) {
            const row = button.closest('tr');
            const statusCell = row.querySelector('.status-pending');
            
            statusCell.innerHTML = 'üîÑ Verifying...';
            statusCell.className = 'status-verifying';
            
            // Simulate verification process
            setTimeout(() => {
                statusCell.innerHTML = '‚úÖ Verified';
                statusCell.className = 'status-verified';
                button.style.display = 'none'; // Hide verify button after verification
                updateCredentialsCount();
                showSuccessConfetti();
            }, 2000);
        }

        // Delete credential
        function deleteCredential(button) {
            if (confirm('Are you sure you want to delete this credential?')) {
                const row = button.closest('tr');
                row.remove();
                updateCredentialsCount();
                alert('Credential deleted successfully!');
            }
        }

        // View credential details
        function viewCredential(number) {
            alert(`Credential Number: ${number}\n\nThis would show full credential details in a real implementation.`);
        }

        // Update credentials count in sidebar
        function updateCredentialsCount() {
            const tbody = document.getElementById('credentials-table-body');
            const totalCredentials = tbody.children.length;
            const pendingCredentials = Array.from(tbody.children).filter(row => 
                row.querySelector('.status-pending') || row.querySelector('.status-verifying')
            ).length;
            
            document.getElementById('credentials-count').textContent = 
                `üìã ${pendingCredentials} of ${totalCredentials} credentials pending`;
        }

        // Show success confetti
        function showSuccessConfetti() {
            // Simple confetti effect
            const confetti = document.createElement('div');
            confetti.innerHTML = 'üéâ';
            confetti.style.position = 'fixed';
            confetti.style.top = '20px';
            confetti.style.right = '20px';
            confetti.style.fontSize = '30px';
            confetti.style.zIndex = '1000';
            document.body.appendChild(confetti);
            
            setTimeout(() => {
                document.body.removeChild(confetti);
            }, 2000);
        }

        // =====================
        // SIMPLE AADHAAR AI VERIFICATION
        // =====================

        // Simple Aadhaar verification
        async function verifyAadhaarPhoto(file) {
            const img = new Image();
            const reader = new FileReader();
            
            return new Promise((resolve) => {
                reader.onload = async function(e) {
                    img.src = e.target.result;
                    
                    img.onload = async function() {
                        document.getElementById('ai-status').innerHTML = "ü§ñ AI is checking Aadhaar card...";
                        
                        try {
                            const model = await mobilenet.load();
                            const predictions = await model.classify(img);
                            
                            const isDocument = predictions.some(pred => 
                                pred.className.includes('card') || 
                                pred.className.includes('document') ||
                                pred.className.includes('paper') ||
                                pred.probability > 0.5
                            );
                            
                            const hasAadhaarColors = await checkAadhaarColors(img);
                            
                            if (isDocument && hasAadhaarColors) {
                                resolve({
                                    success: true,
                                    message: "‚úÖ AI verified as Aadhaar card!",
                                    confidence: "High"
                                });
                            } else if (isDocument) {
                                resolve({
                                    success: true,
                                    message: "‚ö†Ô∏è Looks like a document (may not be Aadhaar)",
                                    confidence: "Medium"
                                });
                            } else {
                                resolve({
                                    success: false,
                                    message: "‚ùå This doesn't look like an Aadhaar card",
                                    confidence: "Low"
                                });
                            }
                            
                        } catch (error) {
                            resolve({
                                success: false,
                                message: "‚ùå AI verification failed",
                                confidence: "Unknown"
                            });
                        }
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        // Simple color detection for Aadhaar orange
        function checkAadhaarColors(img) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            let orangePixels = 0;
            let totalPixels = 0;
            
            for (let i = 0; i < data.length; i += 16) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Aadhaar orange color range
                if (r > 180 && g > 80 && g < 160 && b < 100) {
                    orangePixels++;
                }
                totalPixels++;
            }
            
            return (orangePixels / totalPixels) > 0.02;
        }

        // Trigger AI verification when file is selected
        async function verifyAadhaarOnUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('ai-status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            statusDiv.innerHTML = "üîÑ Analyzing Aadhaar photo...";
            
            const result = await verifyAadhaarPhoto(file);
            
            if (result.success) {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
            } else {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
            }
            
            statusDiv.innerHTML = result.message;
            
            if (result.success) {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // =====================
        // SIMULATED AADHAAR VALIDATION
        // =====================

        function simulateAadhaarValidation(aadhaarNumber) {
            return new Promise((resolve) => {
                // Show validating status
                showToast('üîç Validating Aadhaar with UIDAI...', 'info');
                
                // Simulate API call delay
                setTimeout(() => {
                    // Validation rules
                    const isValidFormat = /^\d{12}$/.test(aadhaarNumber);
                    const checksumValid = validateAadhaarChecksum(aadhaarNumber);
                    const notInFakeDatabase = !isInFakeDatabase(aadhaarNumber);
                    
                    if (isValidFormat && checksumValid && notInFakeDatabase) {
                        resolve({
                            valid: true,
                            message: '‚úÖ Aadhaar validated successfully!',
                            details: 'This Aadhaar number is verified and active.',
                            verificationId: 'VID_' + Math.random().toString(36).substr(2, 9).toUpperCase()
                        });
                    } else {
                        resolve({
                            valid: false,
                            message: '‚ùå Aadhaar validation failed',
                            details: 'Please check the number or use a valid test Aadhaar.',
                            issues: getValidationIssues(aadhaarNumber, isValidFormat, checksumValid, notInFakeDatabase)
                        });
                    }
                }, 3000);
            });
        }

        // Simple checksum validation (simulated)
        function validateAadhaarChecksum(aadhaarNumber) {
            // In real implementation, this would use Verhoeff algorithm
            // For demo, we'll use a simple rule
            const sum = aadhaarNumber.split('').reduce((acc, digit) => acc + parseInt(digit), 0);
            return sum % 10 !== 0; // Simple checksum rule for demo
        }

        // Fake database of "invalid" Aadhaar numbers for demo
        function isInFakeDatabase(aadhaarNumber) {
            const fakeNumbers = [
                '111111111111',
                '999999999999',
                '123456789012',
                '000000000000'
            ];
            return fakeNumbers.includes(aadhaarNumber);
        }

        // Get specific validation issues
        function getValidationIssues(aadhaarNumber, isValidFormat, checksumValid, notInFakeDatabase) {
            const issues = [];
            
            if (!isValidFormat) {
                issues.push('Invalid format (must be 12 digits)');
            }
            if (!checksumValid) {
                issues.push('Checksum validation failed');
            }
            if (!notInFakeDatabase) {
                issues.push('Number found in invalid database');
            }
            
            return issues;
        }

        // Enhanced Aadhaar verification with validation
        async function verifyAadhaarWithValidation() {
            const aadhaarNumber = document.getElementById('aadhaarNumber').value.replace(/\D/g, '');
            
            if (!aadhaarNumber || aadhaarNumber.length !== 12) {
                showToast('Please enter a valid 12-digit Aadhaar number', 'error');
                return;
            }
            
            // Show loading in the table
            const statusCell = document.querySelector('#credentials-table-body tr:last-child td:nth-child(4)');
            if (statusCell) {
                statusCell.innerHTML = 'üîç Validating...';
                statusCell.className = 'status-verifying';
            }
            
            // Simulate UIDAI validation
            const validationResult = await simulateAadhaarValidation(aadhaarNumber);
            
            // Update status
            if (statusCell) {
                if (validationResult.valid) {
                    statusCell.innerHTML = '‚úÖ Verified';
                    statusCell.className = 'status-verified';
                    showToast(validationResult.message, 'success');
                    
                    // Add verification badge
                    addVerificationBadge(validationResult.verificationId);
                } else {
                    statusCell.innerHTML = '‚ùå Invalid';
                    statusCell.style.color = '#e74c3c';
                    showToast(validationResult.message, 'error');
                    
                    // Show detailed issues
                    setTimeout(() => {
                        alert(`Validation Failed:\n${validationResult.details}\n\nIssues:\n- ${validationResult.issues.join('\n- ')}`);
                    }, 1000);
                }
            }
        }

        // Add verification badge to credential
        function addVerificationBadge(verificationId) {
            const actionCell = document.querySelector('#credentials-table-body tr:last-child td:last-child');
            if (actionCell) {
                const badge = document.createElement('div');
                badge.style.background = '#27ae60';
                badge.style.color = 'white';
                badge.style.padding = '2px 8px';
                badge.style.borderRadius = '10px';
                badge.style.fontSize = '0.8em';
                badge.style.marginTop = '5px';
                badge.textContent = `Verified: ${verificationId}`;
                actionCell.appendChild(badge);
            }
        }

        // =====================
        // DEMO AADHAAR VALIDATION FOR JUDGES
        // =====================

        // Add this for demo purposes
        function getDemoAadhaarNumbers() {
            return [
                '123456789012', // Will fail validation (in fake database)
                '234567890123', // Will pass validation
                '345678901234', // Will pass validation
                '456789012345'  // Will fail checksum
            ];
        }

        // Quick test function for judges
        function demoValidation() {
            const demoNumbers = getDemoAadhaarNumbers();
            const randomAadhaar = demoNumbers[Math.floor(Math.random() * demoNumbers.length)];
            document.getElementById('aadhaarNumber').value = randomAadhaar;
            showToast(`Test Aadhaar ${randomAadhaar} loaded - click Validate to test!`, 'info');
        }
        // =====================
// IPFS UPLOAD FUNCTIONALITY
// =====================

let uploadedDocuments = JSON.parse(localStorage.getItem('uploadedDocuments')) || [];

// Upload document to IPFS (simulated)
function uploadToIPFS() {
    const fileInput = document.getElementById('ipfs-file-input');
    const files = fileInput.files;
    
    if (files.length === 0) {
        showToast('Please select a file to upload', 'error');
        return;
    }

    // Show uploading status
    const uploadButton = document.querySelector('#upload-main .btn-primary');
    const originalText = uploadButton.textContent;
    uploadButton.textContent = 'üîÑ Uploading...';
    uploadButton.disabled = true;

    // Simulate IPFS upload process
    setTimeout(() => {
        Array.from(files).forEach(file => {
            const documentData = {
                id: 'doc_' + Math.random().toString(36).substr(2, 9),
                name: file.name,
                type: file.type,
                size: (file.size / 1024).toFixed(2) + ' KB',
                timestamp: new Date().toLocaleString(),
                ipfsHash: 'Qm' + Math.random().toString(36).substr(2, 44), // Simulated IPFS hash
                status: 'Uploaded'
            };
            
            uploadedDocuments.unshift(documentData);
        });

        // Save to localStorage
        localStorage.setItem('uploadedDocuments', JSON.stringify(uploadedDocuments));
        
        // Update UI
        updateUploadedDocumentsList();
        
        // Reset button
        uploadButton.textContent = originalText;
        uploadButton.disabled = false;
        fileInput.value = '';
        
        showToast(`‚úÖ ${files.length} document(s) uploaded successfully!`, 'success');
    }, 2000);
}

// Update the uploaded documents list
function updateUploadedDocumentsList() {
    const container = document.getElementById('uploaded-documents-list');
    
    if (uploadedDocuments.length === 0) {
        container.innerHTML = '<p style="color: #999; font-style: italic;">No documents uploaded yet</p>';
        return;
    }

    container.innerHTML = uploadedDocuments.map(doc => `
        <div class="document-item" style="border: 1px solid #e1e8ed; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #f8f9fa;">
            <div style="display: flex; justify-content: between; align-items: start;">
                <div style="flex: 1;">
                    <h4 style="margin: 0 0 5px 0; color: #5a7a5a;">${doc.name}</h4>
                    <p style="margin: 0; font-size: 0.9em; color: #666;">
                        üìÅ ${doc.type} ‚Ä¢ üìè ${doc.size} ‚Ä¢ üïí ${doc.timestamp}
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8em; color: #8a9b6b;">
                        üîó IPFS Hash: ${doc.ipfsHash}
                    </p>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <span style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                        ${doc.status}
                    </span>
                    <button class="btn btn-primary btn-small" onclick="viewDocument('${doc.id}')">View</button>
                    <button class="btn btn-danger btn-small" onclick="deleteDocument('${doc.id}')">Delete</button>
                </div>
            </div>
        </div>
    `).join('');
}

// View document details
function viewDocument(docId) {
    const doc = uploadedDocuments.find(d => d.id === docId);
    if (doc) {
        alert(`Document Details:\n\nüìÑ Name: ${doc.name}\nüìÅ Type: ${doc.type}\nüìè Size: ${doc.size}\nüïí Uploaded: ${doc.timestamp}\nüîó IPFS Hash: ${doc.ipfsHash}\n\nThis document is stored securely on the decentralized IPFS network.`);
    }
}

// Delete document
function deleteDocument(docId) {
    if (confirm('Are you sure you want to delete this document?')) {
        uploadedDocuments = uploadedDocuments.filter(doc => doc.id !== docId);
        localStorage.setItem('uploadedDocuments', JSON.stringify(uploadedDocuments));
        updateUploadedDocumentsList();
        showToast('Document deleted successfully!', 'success');
    }
}

// Initialize uploaded documents when page loads
document.addEventListener('DOMContentLoaded', function() {
    startInactivityTimer();
    updateUploadedDocumentsList(); // Add this line to load existing documents
});

        // =====================
        // AUTOMATIC SESSION TIMEOUT
        // =====================

        let inactivityTimer;
        const SESSION_TIMEOUT = 5 * 60 * 1000; // 5 minutes
        const WARNING_TIME = 30 * 1000; // 30 seconds warning

        // Start the inactivity timer
        function startInactivityTimer() {
            resetInactivityTimer();
            
            // Listen for user activity
            document.addEventListener('mousemove', resetInactivityTimer);
            document.addEventListener('keypress', resetInactivityTimer);
            document.addEventListener('click', resetInactivityTimer);
            document.addEventListener('scroll', resetInactivityTimer);
        }

        // Reset timer on user activity
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            
            // Clear any existing warning
            const existingWarning = document.getElementById('session-warning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            // Set new timeout
            inactivityTimer = setTimeout(showTimeoutWarning, SESSION_TIMEOUT - WARNING_TIME);
        }

        // Show warning before timeout
        function showTimeoutWarning() {
            const warningModal = document.createElement('div');
            warningModal.id = 'session-warning';
            warningModal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                           background: rgba(0,0,0,0.5); z-index: 9999; display: flex; 
                           align-items: center; justify-content: center;">
                    <div style="background: white; padding: 30px; border-radius: 10px; 
                               text-align: center; max-width: 400px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                        <h3 style="color: #e74c3c; margin-bottom: 15px;">üïí Session About to Expire</h3>
                        <p>Your session will expire in <strong id="countdown">30</strong> seconds due to inactivity.</p>
                        <p style="font-size: 14px; color: #666; margin: 15px 0;">
                            Move your mouse or press any key to continue your session.
                        </p>
                        <button onclick="extendSession()" style="background: #6b8e6b; color: white; 
                               border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;
                               font-size: 16px; margin-top: 10px;">
                            Continue Session
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(warningModal);
            
            // Start countdown
            let secondsLeft = 30;
            const countdownInterval = setInterval(() => {
                secondsLeft--;
                document.getElementById('countdown').textContent = secondsLeft;
                
                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    lockSession();
                }
            }, 1000);
            
            inactivityTimer = setTimeout(lockSession, WARNING_TIME);
        }

        // Extend session when user interacts
        function extendSession() {
            resetInactivityTimer();
            const warningModal = document.getElementById('session-warning');
            if (warningModal) {
                warningModal.remove();
            }
            showToast('Session extended!', 'success');
        }

        // Lock the session
        function lockSession() {
            const lockScreen = document.createElement('div');
            lockScreen.id = 'session-lock';
            lockScreen.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                           background: linear-gradient(135deg, #e8e4d9 0%, #a4b5a0 100%); 
                           z-index: 10000; display: flex; align-items: center; justify-content: center;
                           color: #5a7a5a; text-align: center;">
                    <div style="background: #f8f6f0; padding: 40px; border-radius: 15px; 
                               box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-width: 450px;
                               border-left: 6px solid #6b8e6b;">
                        <h1 style="font-size: 2.5em; margin-bottom: 20px; color: #5a7a5a;">üîí Session Locked</h1>
                        <p style="font-size: 1.2em; margin-bottom: 30px; color: #666;">
                            Your session has expired due to inactivity.
                        </p>
                        <button onclick="unlockSession()" style="background: #6b8e6b; color: white; 
                               border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer;
                               font-size: 1.1em; font-weight: bold; transition: background 0.3s ease;">
                            Continue to Dashboard
                        </button>
                        <p style="margin-top: 20px; font-size: 0.9em; color: #8a9b6b;">
                            For security, your session automatically locks after 5 minutes of inactivity.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(lockScreen);
            
            // Clear displayed data (but keep in localStorage)
            document.getElementById('displayFullName').value = 'Session Locked';
            document.getElementById('displayContactNumber').value = 'Session Locked';
        }

        // Unlock session
        function unlockSession() {
            const lockScreen = document.getElementById('session-lock');
            if (lockScreen) {
                lockScreen.remove();
            }
            
            resetInactivityTimer();
            showToast('Welcome back!', 'success');
            
            // Restore user data
            const savedName = localStorage.getItem('userFullName');
            const savedContact = localStorage.getItem('userContact');
            
            if (savedName) {
                document.getElementById('displayFullName').value = savedName;
            }
            if (savedContact) {
                document.getElementById('displayContactNumber').value = savedContact;
            }
        }

        // Show toast notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'session-toast';
            
            if (type === 'success') {
                toast.style.background = '#27ae60';
            } else if (type === 'error') {
                toast.style.background = '#e74c3c';
            } else {
                toast.style.background = '#3498db';
            }
            
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize session timeout when page loads
        document.addEventListener('DOMContentLoaded', function() {
            startInactivityTimer();
            
            // Add some default credentials
            addCredentialToTable('üÜî Aadhaar Card', 'UIDAI, Government of India', 'AADHAAR', 'XXXX-XXXX-1234');
            addCredentialToTable('üí≥ PAN Card', 'Income Tax Department, India', 'PAN', 'ABCDE1234F');
        });
    </script>
</body>
</html>
